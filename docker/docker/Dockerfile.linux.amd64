# Use a minimal base image
FROM busybox:stable

# Create a non-root user
RUN adduser -D -u 1000 droneuser

# Switch to the non-root user
USER droneuser
WORKDIR /home/droneuser

# Copy the drone-docker binary
COPY --chown=droneuser:droneuser release/linux/amd64/drone-docker /home/droneuser/

# Make sure the binary is executable
RUN chmod +x /home/droneuser/drone-docker

# Set the entrypoint to the drone-docker plugin
ENTRYPOINT ["/home/droneuser/drone-docker"]